{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
    /* ============================================
       VARIABLES CSS POUR LES THÈMES
       ============================================ */
    :root {
        --primary-blue: #1a6dbb;
        --dark-blue: #0d4d8c;
        --light-blue: #e9f2fa;
        --card-bg-light: rgba(255, 255, 255, 0.25);
        --card-shadow-light: rgba(0, 0, 0, 0.1);
        --text-primary-light: #212529;
        --text-secondary-light: #495057;
    }
    
    body.dark-mode {
        --card-bg-light: rgba(30, 30, 30, 0.25);
        --card-shadow-light: rgba(0, 0, 0, 0.3);
        --text-primary-light: #e0e0e0;
        --text-secondary-light: #b0b0b0;
    }
    
    /* ============================================
       HEADER SECTION
       ============================================ */
    .services-hero {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        color: white;
        padding: 5rem 0 3rem;
        text-align: center;
        margin-bottom: 3rem;
        border-radius: 0 0 20px 20px;
        position: relative;
        overflow: hidden;
    }
    
    .services-hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("{% static 'images/services-bg.jpg' %}") center/cover;
        opacity: 0.15;
        z-index: 0;
    }
    
    .services-hero h1 {
        font-size: 3.2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .services-hero .subtitle {
        font-size: 1.3rem;
        opacity: 0.95;
        max-width: 700px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
    }
    
    .stats-bar {
        display: flex;
        justify-content: center;
        gap: 3rem;
        margin-top: 2.5rem;
        position: relative;
        z-index: 1;
        flex-wrap: wrap;
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-number {
        font-size: 2.2rem;
        font-weight: 700;
        display: block;
        margin-bottom: 0.5rem;
    }
    
    .stat-label {
        font-size: 0.95rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    /* ============================================
       FILTER SECTION
       ============================================ */
    .filter-section {
        background: var(--card-bg-light);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .filter-title {
        color: var(--text-primary-light);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .filter-badges {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .filter-badge {
        padding: 0.5rem 1rem;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 25px;
        color: var(--text-secondary-light);
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .filter-badge:hover,
    .filter-badge.active {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        color: white;
        border-color: transparent;
        text-decoration: none;
    }
    
    /* ============================================
       SERVICE CARDS
       ============================================ */
    .service-section {
        padding: 3rem 0 5rem;
        background: linear-gradient(to bottom, transparent, var(--light-blue) 300px);
    }
    
    body.dark-mode .service-section {
        background: linear-gradient(to bottom, transparent, rgba(26, 109, 187, 0.05) 300px);
    }
    
    .service-card {
        background: var(--card-bg-light);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        overflow: hidden;
        height: 100%;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 10px 30px var(--card-shadow-light);
        position: relative;
        opacity: 1 !important;
    }
    
    .service-card.hidden {
        display: none;
    }
    
    .service-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, var(--primary-blue), var(--dark-blue));
        border-radius: 20px 20px 0 0;
        z-index: 2;
    }
    
    .service-card:hover {
        transform: translateY(-15px);
        box-shadow: 0 25px 50px var(--card-shadow-light);
    }
    
    .service-img-container {
        height: 220px;
        overflow: hidden;
        position: relative;
    }
    
    .service-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
    }
    
    .service-card:hover .service-img {
        transform: scale(1.1);
    }
    
    .service-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 50%);
        display: flex;
        align-items: flex-end;
        padding: 1.5rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .service-card:hover .service-overlay {
        opacity: 1;
    }
    
    .service-category {
        background: rgba(255, 255, 255, 0.9);
        color: var(--dark-blue);
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    body.dark-mode .service-category {
        background: rgba(30, 30, 30, 0.9);
        color: #e0e0e0;
    }
    
    .service-icon-container {
        position: absolute;
        top: -25px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.8rem;
        box-shadow: 0 5px 15px rgba(26, 109, 187, 0.4);
        z-index: 3;
    }
    
    .service-content {
        padding: 2rem;
        position: relative;
    }
    
    .service-title {
        color: var(--text-primary-light);
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 1rem;
        line-height: 1.3;
    }
    
    .service-description {
        color: var(--text-secondary-light);
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        min-height: 72px;
    }
    
    .service-btn {
        background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
        text-decoration: none;
    }
    
    .service-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(26, 109, 187, 0.4);
        color: white;
        text-decoration: none;
    }
    
    .service-btn i {
        transition: transform 0.3s ease;
    }
    
    .service-btn:hover i {
        transform: translateX(5px);
    }
    
    /* ============================================
       NO SERVICES MESSAGE
       ============================================ */
    .no-services {
        text-align: center;
        padding: 4rem 0;
    }
    
    .no-services-icon {
        font-size: 4rem;
        color: var(--primary-blue);
        margin-bottom: 1.5rem;
        opacity: 0.7;
    }
    
    .no-services h3 {
        color: var(--text-primary-light);
        margin-bottom: 1rem;
    }
    
    .no-services p {
        color: var(--text-secondary-light);
        max-width: 500px;
        margin: 0 auto;
    }
    
    /* ============================================
       COUNTER SECTION
       ============================================ */
    .services-counter {
        text-align: center;
        margin: 2rem 0;
        padding: 1rem;
        color: var(--text-secondary-light);
        font-size: 0.9rem;
        background: var(--bg-secondary);
        border-radius: 10px;
        border: 1px solid var(--border-color);
    }
    
    .counter-number {
        color: var(--primary-blue);
        font-weight: 700;
        font-size: 1.1rem;
    }
    
    /* ============================================
       ANIMATIONS
       ============================================ */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .fade-in {
        animation: fadeInUp 0.6s ease forwards;
    }
    
    /* ============================================
       RESPONSIVE DESIGN
       ============================================ */
    @media (max-width: 768px) {
        .services-hero {
            padding: 3rem 0 2rem;
        }
        
        .services-hero h1 {
            font-size: 2.2rem;
        }
        
        .services-hero .subtitle {
            font-size: 1.1rem;
        }
        
        .stats-bar {
            gap: 2rem;
        }
        
        .stat-number {
            font-size: 1.8rem;
        }
        
        .service-img-container {
            height: 180px;
        }
        
        .service-content {
            padding: 1.5rem;
        }
        
        .service-title {
            font-size: 1.2rem;
        }
        
        .service-icon-container {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            top: -20px;
        }
    }
    
    @media (max-width: 576px) {
        .services-hero h1 {
            font-size: 1.8rem;
        }
        
        .stats-bar {
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .service-card {
            margin-bottom: 1.5rem;
        }
        
        .filter-badges {
            justify-content: center;
        }
    }
</style>

<!-- HERO SECTION -->
<section class="services-hero">
    <div class="container">
        <h1 class="fade-in"><i class="fas fa-hand-holding-medical me-3"></i>Nos Services Médicaux</h1>
        <p class="subtitle fade-in">
            Découvrez l'excellence de nos services médicaux, où technologie de pointe et expertise humaine se rencontrent pour votre santé
        </p>
        
        <div class="stats-bar fade-in">
            <div class="stat-item">
                <span class="stat-number" id="totalServices">{{ services.count }}</span>
                <span class="stat-label">Services Spécialisés</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">24/7</span>
                <span class="stat-label">Disponibilité</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">100%</span>
                <span class="stat-label">Équipements Modernes</span>
            </div>
        </div>
    </div>
</section>

<!-- FILTER SECTION -->
<div class="container">
    <div class="filter-section fade-in">
        <h4 class="filter-title"><i class="fas fa-filter me-2"></i>Filtrer par spécialité</h4>
        <div class="filter-badges" id="filterContainer">
            <a href="#" class="filter-badge active" data-filter="all">
                Tous les services
            </a>
            <a href="#" class="filter-badge" data-filter="chirurgie">
                <i class="fas fa-scalpel me-1"></i>Chirurgie
            </a>
            <a href="#" class="filter-badge" data-filter="urgence">
                <i class="fas fa-ambulance me-1"></i>Urgences
            </a>
            <a href="#" class="filter-badge" data-filter="imagerie">
                <i class="fas fa-x-ray me-1"></i>Imagerie
            </a>
            <a href="#" class="filter-badge" data-filter="consultation">
                <i class="fas fa-user-md me-1"></i>Consultation
            </a>
            <a href="#" class="filter-badge" data-filter="laboratoire">
                <i class="fas fa-flask me-1"></i>Laboratoire
            </a>
            <a href="#" class="filter-badge" data-filter="medecine">
                <i class="fas fa-heartbeat me-1"></i>Médecine
            </a>
            <a href="#" class="filter-badge" data-filter="pediatrie">
                <i class="fas fa-baby me-1"></i>Pédiatrie
            </a>
            <a href="#" class="filter-badge" data-filter="maternite">
                <i class="fas fa-baby-carriage me-1"></i>Maternité
            </a>
        </div>
    </div>
</div>

<!-- SERVICES SECTION -->
<section class="service-section">
    <div class="container">
        <!-- Counter pour afficher le nombre de services visibles -->
        <div class="services-counter" id="servicesCounter">
            Affichage de <span class="counter-number">{{ services.count }}</span> service{{ services.count|pluralize }}
        </div>
        
        {% if services %}
        <div class="row g-4" id="servicesGrid">
            {% for service in services %}
            <div class="col-lg-4 col-md-6 service-item" 
                 data-name="{{ service.nom|lower }}"
                 data-description="{{ service.description|lower }}"
                 data-id="{{ service.id }}">
                <div class="service-card fade-in">
                    <div class="service-img-container">
                        {% if service.image %}
                        <img src="{{ service.image.url }}" class="service-img" alt="{{ service.nom }}">
                        {% else %}
                        <img src="{% static 'images/default-service.jpg' %}" class="service-img" alt="Service médical">
                        {% endif %}
                        <div class="service-overlay">
                            <span class="service-category" id="serviceCategory{{ service.id }}">
                                <!-- Catégorie détectée automatiquement -->
                            </span>
                        </div>
                    </div>
                    
                    <!-- Icon détecté automatiquement -->
                    <div class="service-icon-container" id="serviceIcon{{ service.id }}">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    
                    <div class="service-content">
                        <h3 class="service-title">{{ service.nom }}</h3>
                        
                        <p class="service-description">
                            {{ service.description|truncatechars:150 }}
                        </p>
                        
                        <a href="{% url 'service_detail_guest' service.pk %}" class="service-btn">
                            <span>Découvrir le service</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Message quand aucun service ne correspond au filtre -->
        <div class="no-services fade-in" id="noServicesMessage" style="display: none;">
            <div class="no-services-icon">
                <i class="fas fa-search"></i>
            </div>
            <h3>Aucun service trouvé</h3>
            <p>Aucun service ne correspond à votre recherche. Essayez de sélectionner une autre catégorie.</p>
        </div>
        
        {% else %}
        <div class="no-services fade-in">
            <div class="no-services-icon">
                <i class="fas fa-hospital"></i>
            </div>
            <h3>Aucun service disponible pour le moment</h3>
            <p>Nos services sont actuellement en maintenance ou en cours de mise à jour. Veuillez revenir ultérieurement.</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- CTA SECTION -->
<section class="py-5" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 text-white">
                <h3 class="mb-3"><i class="fas fa-info-circle me-2"></i>Besoin d'informations supplémentaires ?</h3>
                <p class="mb-0">Notre équipe est à votre disposition pour répondre à toutes vos questions concernant nos services médicaux.</p>
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                <a href="{% url 'contact' %}" class="btn btn-light btn-lg px-4">
                    <i class="fas fa-phone-alt me-2"></i>Nous contacter
                </a>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterBadges = document.querySelectorAll('.filter-badge');
    const serviceItems = document.querySelectorAll('.service-item');
    const servicesGrid = document.getElementById('servicesGrid');
    const noServicesMessage = document.getElementById('noServicesMessage');
    const servicesCounter = document.getElementById('servicesCounter');
    const counterNumber = servicesCounter ? servicesCounter.querySelector('.counter-number') : null;
    
    // Dictionnaire de mots-clés pour chaque catégorie
    const categoryKeywords = {
        'chirurgie': ['chirurgie', 'chirurgical', 'opératoire', 'bloc opératoire', 'scalpel', 'intervention'],
        'urgence': ['urgence', 'urgent', 'urgences', 'accueil', 'trauma', 'traumatisme', 'umc'],
        'imagerie': ['imagerie', 'radiologie', 'scanner', 'irm', 'échographie', 'radio', 'x-ray'],
        'consultation': ['consultation', 'médecin', 'généraliste', 'spécialiste', 'examen', 'diagnostic'],
        'laboratoire': ['laboratoire', 'analyse', 'sang', 'prélèvement', 'biologie', 'microbiologie'],
        'cardiologie': ['cardiologie', 'cardiaque', 'cœur', 'cardiaque', 'électrocardiogramme', 'ECG'],
        'pediatrie': ['pédiatrie', 'enfant', 'néonatal', 'bébé', 'nouveau-né', 'adolescent', 'néonatologie','umc'],
        'maternite': ['maternité', 'accouchement', 'gynécologie', 'obstétrique', 'naissance', 'grossesse']
    };
    
    // Dictionnaire d'icônes pour chaque catégorie
    const categoryIcons = {
        'chirurgie': 'fas fa-scalpel',
        'urgence': 'fas fa-ambulance',
        'imagerie': 'fas fa-x-ray',
        'consultation': 'fas fa-user-md',
        'laboratoire': 'fas fa-flask',
        'cardiologie': 'fas fa-heartbeat',
        'pediatrie': 'fas fa-baby',
        'maternite': 'fas fa-baby-carriage',
        'default': 'fas fa-stethoscope'
    };
    
    // Dictionnaire de noms de catégories en français
    const categoryNames = {
        'chirurgie': 'Chirurgie',
        'urgence': 'Urgences',
        'imagerie': 'Imagerie',
        'consultation': 'Consultation',
        'laboratoire': 'Laboratoire',
        'cardiologie': 'Cardiologie',
        'pediatrie': 'Pédiatrie',
        'maternite': 'Maternité',
        'default': 'Médecine'
    };
    
    // Fonction pour détecter la catégorie d'un service
    function detectServiceCategory(serviceName, serviceDescription) {
        const text = (serviceName + ' ' + serviceDescription).toLowerCase();
        
        for (const [category, keywords] of Object.entries(categoryKeywords)) {
            for (const keyword of keywords) {
                if (text.includes(keyword)) {
                    return category;
                }
            }
        }
        
        return 'default';
    }
    
    // Fonction pour attribuer les catégories et icônes aux services
    function categorizeServices() {
        serviceItems.forEach(item => {
            const serviceName = item.getAttribute('data-name');
            const serviceDescription = item.getAttribute('data-description');
            const serviceId = item.getAttribute('data-id');
            
            const detectedCategory = detectServiceCategory(serviceName, serviceDescription);
            
            // Ajouter la catégorie comme attribut
            item.setAttribute('data-category', detectedCategory);
            
            // Mettre à jour l'icône
            const iconElement = document.getElementById(`serviceIcon${serviceId}`);
            if (iconElement) {
                iconElement.innerHTML = `<i class="${categoryIcons[detectedCategory] || categoryIcons.default}"></i>`;
            }
            
            // Mettre à jour la catégorie affichée
            const categoryElement = document.getElementById(`serviceCategory${serviceId}`);
            if (categoryElement) {
                categoryElement.textContent = categoryNames[detectedCategory] || categoryNames.default;
            }
        });
    }
    
    // Appliquer les catégories
    categorizeServices();
    
    // Filtrage client-side (JavaScript)
    filterBadges.forEach(badge => {
        badge.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Mettre à jour les badges actifs
            filterBadges.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Appliquer le filtre
            const filterValue = this.getAttribute('data-filter');
            applyFilter(filterValue);
        });
    });
    
    function applyFilter(filterValue) {
        let visibleCount = 0;
        
        serviceItems.forEach(item => {
            const itemCategory = item.getAttribute('data-category');
            
            if (filterValue === 'all' || itemCategory === filterValue) {
                item.style.display = 'block';
                visibleCount++;
                
                // Animation d'apparition
                item.style.animation = 'fadeInUp 0.6s ease forwards';
                item.style.opacity = '1';
            } else {
                item.style.display = 'none';
                item.style.opacity = '0';
            }
        });
        
        // Afficher/masquer le message "aucun service"
        if (visibleCount === 0 && servicesGrid && noServicesMessage) {
            servicesGrid.style.display = 'none';
            noServicesMessage.style.display = 'block';
            noServicesMessage.style.animation = 'fadeIn 0.6s ease forwards';
        } else if (servicesGrid && noServicesMessage) {
            servicesGrid.style.display = 'flex';
            noServicesMessage.style.display = 'none';
        }
        
        // Mettre à jour le compteur
        if (counterNumber) {
            counterNumber.textContent = visibleCount;
            const plural = visibleCount > 1 ? 's' : '';
            servicesCounter.innerHTML = `Affichage de <span class="counter-number">${visibleCount}</span> service${plural}`;
        }
        
        // Mettre à jour l'URL sans rechargement
        const urlParams = new URLSearchParams(window.location.search);
        if (filterValue !== 'all') {
            urlParams.set('filter', filterValue);
        } else {
            urlParams.delete('filter');
        }
        window.history.replaceState({}, '', `${window.location.pathname}?${urlParams}`);
    }
    
    // Appliquer le filtre initial basé sur l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const initialFilter = urlParams.get('filter') || 'all';
    
    // Activer le bon badge
    const initialBadge = document.querySelector(`.filter-badge[data-filter="${initialFilter}"]`);
    if (initialBadge) {
        filterBadges.forEach(b => b.classList.remove('active'));
        initialBadge.classList.add('active');
    }
    
    // Appliquer le filtre après un court délai pour laisser le temps de catégoriser
    setTimeout(() => {
        applyFilter(initialFilter);
    }, 100);
    
    // Animation au scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && entry.target.style.display !== 'none') {
                entry.target.style.opacity = '1';
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, observerOptions);
    
    serviceItems.forEach(item => {
        if (item.style.display !== 'none') {
            observer.observe(item);
        }
    });
});
</script>
{% endblock %}
